var ajax_ops=function(t){function e(t){var e=$(t),r=e.attr("data-url")||e.attr("href"),o=e.attr("data-loading-target")||e.attr("data-target"),s=e.attr("data-where");$targets=a.get_target(o,e,s),$.ajax({url:r,dataType:"json",data:{_:(new Date).getTime()},beforeSend:function(){$targets.addClass("loading")},complete:function(){$targets.removeClass("loading")},error:function(t){a.flashmsg&&a.flashmsg({type:"danger",html:t.responseText})},success:function(e){a.exec_ops({ops:e,base_element:t})}})}var a={};return a.ops={},a.flashmsg_opts={selector:".content:first"},a.get_target=function(t,e,a){return e?"closest"==a?e.closest(t):"inside"==a?e.children(t):$(t):$(t)},a.flashmsg=function(e){var r,o=e.base_target||this&&$(this),s=e.where,l=e.selector;e||(e={}),e.type||(e.type="info"),r=a.get_target(l,o,s),r.length||(r=$(a.flashmsg_opts.selector)),r.length||(r=$(t.body)),r.prepend(a.templates.flashmsg(e))},a.submit_form=function(t,e){var r,o=$(t);return e||(e={}),e.target?r=e.target:(r=$(o.attr("data-target")),r.length||(r=o)),$.ajax({type:o.attr("method")||"post",url:o.attr("action"),data:o.serialize(),beforeSend:function(){r.addClass("loading")},complete:function(){r.removeClass("loading")},error:function(t){a.flashmsg&&a.flashmsg({type:"danger",html:t.responseText,base_target:r})},success:function(t){r.html(t),e.cb&&e.cb(r,t)}}),!1},a.loads=function(t){var e=$(t.el),r=$("<div>"),o=t.how||"replace";t.template?r.html(a.templates[t.template](t.data)):t.html?r.html(t.html):r.text(t.text);var s=r.html();"replace"==o?e.html(s):"append"==o?e.append(s):"prepend"==o&&e.prepend(s)},a.load=function(t){var e,r,o,s,l,n=t.el,d=$(n),i=t.url||d.attr("data-url")||d.attr("href"),g=t.how||d.attr("data-how")||"replace",f=t.selector||d.attr("data-target"),c=t.where||d.attr("data-where"),h=t.loading_selector||d.attr("data-loading-target");o=f?a.get_target(f,d,c):d,l=h?a.get_target(h,d,c):o,$.ajax({url:i,dataType:"html",data:{_:(new Date).getTime()},beforeSend:function(){l.addClass("loading")},complete:function(){l.removeClass("loading")},error:function(t){a.flashmsg&&a.flashmsg({type:"danger",html:t.responseText})},success:function(t){o.each(function(o,l){e={how:g,el:l},r=$(l),e.template=d.attr("data-template")||r.attr("data-template"),s=d.attr("data-format")||r.attr("data-format")||"html",e.template?e.data=$.parseJSON(t):"html"==s?e.html=t:e.text=t,a.loads(e)})}})},a.refresh=function(t,e){e||(e={});var r,o,s;e.base_element&&(o=$(e.base_element)),"string"==typeof t?(r=t,$targets=o?a.get_target(r,o,e.where):$(r),delete e.where,$targets.each(function(t,r){a.refresh(r,e)})):(s=$(t),e.el=t,e.url=s.attr("data-refresh-url")||s.attr("data-url")||s.attr("href"),load(e))},a.exec_ops=function(t){var e,r,o,s,l,n,d,i,g,f=t.ops,c=t.base_element,h=c&&$(c);for(e in f)s=f[e],l=s[0],n=s[1],d=s.length>2?s[2]:{},g=h?a.get_target(n,h,d.where):$(n),g.each(function(t,e){if(i=$(e),"remove"==l)i.remove();else if("load"==l)d.el=e,a.loads(d);else if("refresh"==l)a.refresh(e);else if("attr"==l){if(d.set)for(r in d.set)o=d.set[r],i.attr(r,o);if(d.unset)for(r in d.unset)i.removeAttr(d.unset[r])}else if("class"==l){if(d.add)for(r in d.add)i.addClass(d.add[r]);if(d.remove)for(r in d.remove)i.removeClass(d.remove[r]);if(d.toggle)for(r in d.toggle)i.toggleClass(d.toggle[r])}else a.ops[l]?a.ops[l](e,d):console.log("do not know how to do ["+l+"]")})},$(t).on("click",'[data-toggle="ajax-load"]',function(){a.load({el:this})}),$(t).on("click",'[data-toggle="ajax-ops"]',function(){e(this)}),a}(document,window);